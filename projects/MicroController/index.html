<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Micro Controller Design Based on VHDL - Zhihao Li - Zhihao Li&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="Zhihao Li - Zhihao Li&#039;s Blog"><meta name="msapplication-TileImage" content="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/profile/logo_light.png"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Zhihao Li - Zhihao Li&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="This post introduces how to design a micro controller using the VHDL language and verify its functions."><meta property="og:type" content="blog"><meta property="og:title" content="Micro Controller Design Based on VHDL"><meta property="og:url" content="https://lzhms.github.io/projects/MicroController/"><meta property="og:site_name" content="Zhihao Li - Zhihao Li&#039;s Blog"><meta property="og:description" content="This post introduces how to design a micro controller using the VHDL language and verify its functions."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194153.png"><meta property="article:published_time" content="2024-04-28T12:03:00.000Z"><meta property="article:modified_time" content="2024-12-09T09:27:14.799Z"><meta property="article:author" content="Zhihao Li"><meta property="article:tag" content="Computer Principle"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194153.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://lzhms.github.io/projects/MicroController/"},"headline":"Micro Controller Design Based on VHDL","image":["https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194153.png"],"datePublished":"2024-04-28T12:03:00.000Z","dateModified":"2024-12-09T09:27:14.799Z","author":{"@type":"Person","name":"Zhihao Li"},"publisher":{"@type":"Organization","name":"Zhihao Li - Zhihao Li's Blog","logo":{"@type":"ImageObject","url":"https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/profile/logo_light.png"}},"description":"This post introduces how to design a micro controller using the VHDL language and verify its functions."}</script><link rel="canonical" href="https://lzhms.github.io/projects/MicroController/"><link rel="icon" href="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/profile/logo_light.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="/css/icons/iconfont.css"><link data-pjax rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/style.css"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column"><canvas id="universe"></canvas><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img class="logo-img" src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/profile/logo_light.png" alt="Zhihao Li - Zhihao Li&#039;s Blog" height="28"><img class="logo-img-dark" src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/profile/logo_dark.png" alt="Zhihao Li - Zhihao Li&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">ZHIHAO LI&#039;S LOG BOOK</a><a class="navbar-item" href="/blog">BLOG</a><a class="navbar-item" href="/intuition">INTUITION</a><a class="navbar-item" href="/publications">PUBLICATIONS</a><a class="navbar-item" href="/projects">PROJECTS</a><a class="navbar-item" href="/essay">ESSAY</a><a class="navbar-item" href="/readings">READINGS</a><a class="navbar-item" href="/collaboration">COLLABORATION</a><a class="navbar-item" href="/archives">ARCHIVES</a><a class="navbar-item" href="/categories">CATEGORIES</a><a class="navbar-item" href="/tags">TAGS</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/LZHMS"><i class="iconfont icon-github"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/LZHMS"><i class="iconfont icon-gitee1"></i></a><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194153.png" alt="Micro Controller Design Based on VHDL"></span></div><article class="card-content article" role="article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">Micro Controller Design Based on VHDL</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="far fa-calendar-alt"> </i><time dateTime="2024-04-28T12:03:00.000Z" title="2024-04-28T12:03:00.000Z">2024-04-28</time></span><span class="level-item is-hidden-mobile"><i class="far fa-calendar-check"> </i><time dateTime="2024-12-09T09:27:14.799Z" title="2024-12-09T09:27:14.799Z">2024-12-09</time></span><span class="level-item"><i class="far fa-folder-open has-text-grey"></i> <a class="link-muted" href="/projects/">projects</a></span><span class="level-item"><i class="far fa-clock"></i> 21 minutes read (About 3208 words)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><div class="content"><h2 id="一、实验目的"><a href="#一、实验目的" class="headerlink" title="一、实验目的"></a>一、实验目的</h2><ol>
<li>掌握微控制器功能及工作原理；</li>
<li>掌握微控制器与其他模块信号之间的关联性。</li>
</ol>
<h2 id="二、实验要求"><a href="#二、实验要求" class="headerlink" title="二、实验要求"></a>二、实验要求</h2><ol>
<li>将指令分解为基本的微命令序列，把操作控制信号编制成微指令，存放到控制存储器 (CM)；</li>
<li>程序运行时，从控存中取出微指令，产生指令运行所需的操作控制信号。</li>
</ol>
<h2 id="三、实验方案及工作原理"><a href="#三、实验方案及工作原理" class="headerlink" title="三、实验方案及工作原理"></a>三、实验方案及工作原理</h2><h3 id="微程序控制器基本结构"><a href="#微程序控制器基本结构" class="headerlink" title="微程序控制器基本结构"></a>微程序控制器基本结构</h3><img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194209.png" alt="微程序控制器基本结构" width="80%"/>

<pre><code>在该实验中，微程序控制器主要由控制存储器CM、微指令寄存器$\mu$IR、微地址形成电路、微地址寄存器$\mu$AR模块组成，其中各模块功能分析如下：
</code></pre>
<ul>
<li>控制存储器CM：存放不同机器指令对应的微程序；</li>
<li>微指令寄存器$\mu$IR：存放现行微指令；</li>
<li>微地址形成电路：提供下一条微命令对应的微地址；</li>
<li>微地址寄存器$\mu$AR：存在现在微地址；</li>
</ul>
<h3 id="控制信号汇总"><a href="#控制信号汇总" class="headerlink" title="控制信号汇总"></a>控制信号汇总</h3><h4 id="PC-模块（4条）"><a href="#PC-模块（4条）" class="headerlink" title="PC 模块（4条）"></a>PC 模块（4条）</h4><ul>
<li>LD_PC: in std_logic;              – 装载新地址</li>
<li>M_PC: in std_logic;                –PC 加 1 控制信号</li>
<li>nPCH, nPCL: in std_logic;     –PC 输出总线控制信号</li>
</ul>
<h4 id="ROM-模块（2条）"><a href="#ROM-模块（2条）" class="headerlink" title="ROM 模块（2条）"></a>ROM 模块（2条）</h4><ul>
<li>M_ROM: in std_logic;             –ROM 片选信号</li>
<li>ROM_EN: in std_logic;           –ROM 使能信号</li>
</ul>
<h4 id="IR-模块（4-条）"><a href="#IR-模块（4-条）" class="headerlink" title="IR 模块（4 条）"></a>IR 模块（4 条）</h4><ul>
<li>LD_IR1,LD_IR2,LD_IR3: in std_logic; 		–IR 指令存储控制信号</li>
<li>nARen :in std_logic; 					–IR 中 RAM 地址控制信号</li>
</ul>
<h4 id="RN-模块（4-条）"><a href="#RN-模块（4-条）" class="headerlink" title="RN 模块（4 条）"></a>RN 模块（4 条）</h4><ul>
<li>Ri_CS: in std_logic; 		–RN 选择信号</li>
<li>Ri_EN :in std_logic; 		–RN 寄存器使能</li>
<li>RDRi,WRRi :in std_logic; 		–RN 读写信号</li>
</ul>
<h4 id="ALU-模块（13-条）"><a href="#ALU-模块（13-条）" class="headerlink" title="ALU 模块（13 条）"></a>ALU 模块（13 条）</h4><ul>
<li>M_A,M_B :in std_logic; 		–暂存器控制信号</li>
<li>M_F :in std_logic; 			–程序状态字控制信号</li>
<li>nALU_EN :in std_logic;		 –ALU 运算结果输出使能</li>
<li>nPSW_EN :in std_logic;   		 –PSW 输出使能</li>
<li>C0 :in std_logic;				 –进位输入</li>
<li>S:in std_logic_vector(4 downto 0); 	–运算类型和操作选择</li>
<li>F_in:in std_logic_vector(1 downto 0);		 –移位功能选择</li>
</ul>
<h4 id="RAM-模块（3-条）"><a href="#RAM-模块（3-条）" class="headerlink" title="RAM 模块（3 条）"></a>RAM 模块（3 条）</h4><ul>
<li>RAM_CS :in std_logic; 		–RAM 片选信号</li>
<li>nRAM_EN :in std_logic; 		–RAM 输出使能信号</li>
<li>wr_nRD :in std_logic;			 – 读写信号</li>
</ul>
<h3 id="控制信号设计"><a href="#控制信号设计" class="headerlink" title="控制信号设计"></a>控制信号设计</h3><ul>
<li>39条控制信号（39位编码）</li>
<li>27条指令（5位编码）</li>
</ul>
<h3 id="微指令编码设计"><a href="#微指令编码设计" class="headerlink" title="微指令编码设计"></a>微指令编码设计</h3><img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194228.png" alt="微指令编码结构" width="80%"/>

<p>根据实验手册，设计 48 位的微指令各编码段如上图所示，对应所有控制信号和寄存器；</p>
<h4 id="取指公操作：微程序入口地址-00H"><a href="#取指公操作：微程序入口地址-00H" class="headerlink" title="取指公操作：微程序入口地址 00H"></a>取指公操作：微程序入口地址 00H</h4><img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194240.png" alt="取指公操作编码设计" width="80%"/>

<p>该微指令的入口地址为 00H，当指令寄存器加载地址 00H时会将该条取指指令加载出来形成取指操作；同理，可以设计出其他所有的微指令；</p>
<h3 id="微程序设计"><a href="#微程序设计" class="headerlink" title="微程序设计"></a>微程序设计</h3><h4 id="MOV-Ri-data：微程序入口地址-24H"><a href="#MOV-Ri-data：微程序入口地址-24H" class="headerlink" title="MOV Ri, #data：微程序入口地址 24H"></a>MOV Ri, #data：微程序入口地址 24H</h4><img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194252.png" alt="机器指令微程序设计" width="80%"/>

<ul>
<li>一条机器指令MOV操作被分解为3条微指令，形成一个微程序；</li>
<li>该段微程序入口地址为 24H，即当执行该条机器指令时，首先由取指共操作取出该条指令，然后根据 IR 寄存器进入到改微程序入口，开始顺序执行每一条微指令；</li>
<li>微程序执行完毕后，再次回到 00H，重新进行取指公操作，得到下一条机器指令对应的微程序；</li>
</ul>
<p>故此，可以根据指令编码以及机器指令执行特点设计出每一条机器指令对应的微程序，然后根据微程序进行实验验证；</p>
<h2 id="四、实验配置"><a href="#四、实验配置" class="headerlink" title="四、实验配置"></a>四、实验配置</h2><h3 id="微程序设计-1"><a href="#微程序设计-1" class="headerlink" title="微程序设计"></a>微程序设计</h3><pre><code>在本次实验中，为了进一步验证微控制器工作原理，我设计了3条机器指令：sub Ri, Rj; add Ri，Rj; and Ri, Rj. 其对应的微指令编码如下所示：
</code></pre>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">000000000011000100011001111100110111100000000000 --003119F378   00(00h)</span><br><span class="line">100000000011000100011001111100110111100100000010 --803119F379   02(01h)      sub ri, rj </span><br><span class="line">100000000011000100110001111100110111101100000011 --803131F37B   03(02h)</span><br><span class="line">100000000011000100010001011100110111011100000100 --8031117377   04(03h)</span><br><span class="line">100000000011000100010001011100110111011100000101 --8031117377   05(04h)</span><br><span class="line">100000000011000101110001111100110111101100000110 --803171F37B   06(05h)</span><br><span class="line">100000000011000100110011111100110111101100000111 --803133F37B   07(06h)</span><br><span class="line">100000000011000100110000111100110111101100001000 --803130F37B   08(07h)</span><br><span class="line">100000000011000100110001111100110111100000000000 --803131F378   00(08h)</span><br><span class="line">100000000011000100011001111100110010000100001010 --803119F321   0A(09h)    add ri, rj</span><br><span class="line">100000000011000100110001111100110010001000001011 --803131F322   0B(0Ah)</span><br><span class="line">100000000011000100010001011100110010001100001100 --8031117323   0C(0Bh)</span><br><span class="line">100000000011000100010001011100110010010000000000 --8031117324   00(0Ch)</span><br><span class="line">100000000011000101110001111100110011000100001110 --803171F331   0E(0Dh)    and ri, rj</span><br><span class="line">100000000011000100110011111100110011001000001111 --803133F332   0F(0Eh)</span><br><span class="line">100000000011000100110000111100110011001100010000 --803130F333   10(0Fh)</span><br><span class="line">100000000011000100110001111100110011010000000000 --803131F334   00(10h)</span><br></pre></td></tr></table></figure>

<h3 id="微控制器功能设计"><a href="#微控制器功能设计" class="headerlink" title="微控制器功能设计"></a>微控制器功能设计</h3><p>针对微控制器的工作原理，在本次实验中设计的功能如下所示：</p>
<ul>
<li>复位功能：当复位信号有效时，微控制器进行复位，所有寄存器均不存储数据；</li>
<li>使能信号：只有该信号高电平有效时，微控制器才能够正常工作，否则一直保持刚取得的微指令；</li>
<li>指令跳转：该功能使得微控制器可以根据 IR 寄存器中的地址，获取下一条微指令的地址，这使得微控制器可以跳转到不同机器指令的微程序入口，然后继续顺序执行；</li>
<li>指令执行：该功能保证微控制在进入微程序后获取相应的微指令后，可以根据地址译码电路自动获得下一条微指令的地址；</li>
</ul>
<h2 id="五、实验源码"><a href="#五、实验源码" class="headerlink" title="五、实验源码"></a>五、实验源码</h2><h3 id="顶层模块设计"><a href="#顶层模块设计" class="headerlink" title="顶层模块设计"></a>顶层模块设计</h3><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span> IEEE;</span><br><span class="line"><span class="keyword">use</span> IEEE.STD_LOGIC_1164.<span class="keyword">ALL</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">entity</span> micro <span class="keyword">is</span></span><br><span class="line"><span class="keyword">Port</span> (clk, rst : <span class="keyword">in</span> <span class="built_in">std_logic</span>;</span><br><span class="line">    seg_sel : <span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">15</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">    seg_data : <span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">    clk_mc,m_ua,cmrom_cs:<span class="keyword">in</span> <span class="built_in">std_logic</span>;</span><br><span class="line">    ir:<span class="keyword">in</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">2</span>) );</span><br><span class="line"><span class="keyword">end</span> micro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">architecture</span> Behavioral <span class="keyword">of</span> micro <span class="keyword">is</span></span><br><span class="line"><span class="keyword">signal</span> showw:<span class="built_in">std_logic_vector</span>(<span class="number">63</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">component</span> state <span class="keyword">is</span></span><br><span class="line"><span class="keyword">Port</span> (clk, rst : <span class="keyword">in</span> <span class="built_in">std_logic</span>;</span><br><span class="line">        key_in:<span class="keyword">in</span> <span class="built_in">std_logic_vector</span>(<span class="number">15</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">        seg_sel : <span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">15</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">        seg_data : <span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">        show:<span class="keyword">in</span> <span class="built_in">std_logic_vector</span>(<span class="number">63</span> <span class="keyword">downto</span> <span class="number">0</span>) );</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">component</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">component</span> micro_controller <span class="keyword">is</span></span><br><span class="line"><span class="keyword">Port</span> (clk_mc,m_ua,cmrom_cs:<span class="keyword">in</span> <span class="built_in">std_logic</span>;</span><br><span class="line">        ir:<span class="keyword">in</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">2</span>);</span><br><span class="line">        arr:<span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">        next_arr:<span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">        cm:<span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">47</span> <span class="keyword">downto</span> <span class="number">8</span>) );</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">component</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    u1: state <span class="keyword">port</span> <span class="keyword">map</span>(clk=&gt;clk,</span><br><span class="line">                        rst=&gt;rst,</span><br><span class="line">                        seg_sel=&gt;seg_sel,</span><br><span class="line">                        seg_data=&gt;seg_data,</span><br><span class="line">                        show=&gt;showw,</span><br><span class="line">                        key_in=&gt;x<span class="string">&quot;ffff&quot;</span>);</span><br><span class="line">    u2: micro_controller <span class="keyword">port</span> <span class="keyword">map</span>(clk_mc=&gt;clk,</span><br><span class="line">                                 m_ua=&gt;m_ua,</span><br><span class="line">                                 cmrom_cs=&gt;cmrom_cs,</span><br><span class="line">                                 ir=&gt;ir,</span><br><span class="line">                                 cm=&gt;showw(<span class="number">39</span> <span class="keyword">downto</span> <span class="number">0</span>),</span><br><span class="line">                                 next_arr =&gt; showw(<span class="number">47</span> <span class="keyword">downto</span> <span class="number">40</span>),</span><br><span class="line">                                 arr=&gt;showw(<span class="number">55</span> <span class="keyword">downto</span> <span class="number">48</span>));</span><br><span class="line"><span class="keyword">end</span> Behavioral;</span><br></pre></td></tr></table></figure>

<h3 id="微控制器模块设计"><a href="#微控制器模块设计" class="headerlink" title="微控制器模块设计"></a>微控制器模块设计</h3><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span> IEEE;</span><br><span class="line"><span class="keyword">use</span> IEEE.STD_LOGIC_1164.<span class="keyword">ALL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">entity</span> micro_controller <span class="keyword">is</span></span><br><span class="line"><span class="keyword">Port</span> (clk_mc,m_ua,cmrom_cs:<span class="keyword">in</span> <span class="built_in">std_logic</span>;</span><br><span class="line">    ir:<span class="keyword">in</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">2</span>);</span><br><span class="line">    arr:<span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">    next_arr:<span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">    cm:<span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">47</span> <span class="keyword">downto</span> <span class="number">8</span>) );</span><br><span class="line"><span class="keyword">end</span> micro_controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">architecture</span> Behavioral <span class="keyword">of</span> micro_controller <span class="keyword">is</span></span><br><span class="line">    <span class="keyword">component</span> cmrom <span class="keyword">is</span></span><br><span class="line">    <span class="keyword">Port</span> (m_rom,nrom_en:<span class="keyword">in</span> <span class="built_in">std_logic</span>;</span><br><span class="line">        addr:<span class="keyword">in</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">        data:<span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">47</span> <span class="keyword">downto</span> <span class="number">0</span>) );</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">component</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">signal</span> uar:<span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>) := (<span class="keyword">others</span> =&gt; <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">signal</span> uir:<span class="built_in">std_logic_vector</span>(<span class="number">47</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line"><span class="keyword">signal</span> clkk:<span class="built_in">std_logic</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    cm1:cmrom <span class="keyword">port</span> <span class="keyword">map</span>(m_rom=&gt;cmrom_cs,</span><br><span class="line">                   nrom_en=&gt;<span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">                   addr=&gt;uar,</span><br><span class="line">                   data=&gt;uir);</span><br><span class="line">                 </span><br><span class="line">    cm &lt;= uir(<span class="number">47</span> <span class="keyword">downto</span> <span class="number">8</span>);    <span class="comment">--   控制字段</span></span><br><span class="line">    next_arr &lt;= uir(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>);    <span class="comment">--   下条地址字段</span></span><br><span class="line">    arr &lt;= uar;    <span class="comment">--  当前地址</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">-- clkk   50000000   </span></span><br><span class="line"><span class="keyword">process</span>(clk_mc)</span><br><span class="line">    <span class="keyword">variable</span> count: <span class="built_in">integer</span> <span class="keyword">range</span> <span class="number">0</span> <span class="keyword">to</span> <span class="number">60000000</span>;</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> clk_mc<span class="symbol">&#x27;event</span> <span class="keyword">and</span> clk_mc=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span></span><br><span class="line">            count:=count+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> count=<span class="number">50000000</span> <span class="keyword">then</span></span><br><span class="line">                clkk&lt;=<span class="keyword">not</span> clkk;</span><br><span class="line">                count:=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">process</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">process</span>(m_ua,clkk)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> rising_edge(clkk) <span class="keyword">then</span> </span><br><span class="line">            <span class="keyword">if</span> cmrom_cs = <span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">if</span> m_ua = <span class="string">&#x27;1&#x27;</span><span class="keyword">then</span></span><br><span class="line">                    uar(<span class="number">5</span> <span class="keyword">downto</span> <span class="number">0</span>) &lt;= ir;</span><br><span class="line">                    uar(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">6</span>) &lt;= <span class="string">&quot;00&quot;</span>;</span><br><span class="line">                <span class="keyword">elsif</span> m_ua=<span class="string">&#x27;0&#x27;</span> <span class="keyword">then</span></span><br><span class="line">                    uar&lt;=uir(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">process</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> Behavioral;</span><br></pre></td></tr></table></figure>


<h3 id="控制存储器模块设计"><a href="#控制存储器模块设计" class="headerlink" title="控制存储器模块设计"></a>控制存储器模块设计</h3><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span> IEEE;</span><br><span class="line"><span class="keyword">use</span> IEEE.STD_LOGIC_1164.<span class="keyword">ALL</span>;</span><br><span class="line"><span class="keyword">use</span> IEEE.STD_LOGIC_UNSIGNED.<span class="keyword">ALL</span>;</span><br><span class="line"><span class="keyword">use</span> IEEE.STD_LOGIC_TEXTIO.<span class="keyword">ALL</span>;</span><br><span class="line"><span class="keyword">use</span> std.textio.<span class="keyword">all</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">entity</span> cmrom <span class="keyword">is</span></span><br><span class="line"><span class="keyword">Port</span> (m_rom,nrom_en:<span class="keyword">in</span> <span class="built_in">std_logic</span>;</span><br><span class="line">    addr:<span class="keyword">in</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">    data:<span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">47</span> <span class="keyword">downto</span> <span class="number">0</span>) );</span><br><span class="line"><span class="keyword">end</span> cmrom;</span><br><span class="line"></span><br><span class="line"><span class="keyword">architecture</span> Behavioral <span class="keyword">of</span> cmrom <span class="keyword">is</span></span><br><span class="line"><span class="keyword">type</span> matrix <span class="keyword">is</span> <span class="keyword">array</span>(<span class="built_in">integer</span> <span class="keyword">range</span>&lt;&gt;) <span class="keyword">of</span> <span class="built_in">std_logic_vector</span>(<span class="number">47</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line"><span class="keyword">signal</span> rom:matrix (<span class="number">0</span> <span class="keyword">to</span> <span class="number">2</span>**<span class="number">8</span>-<span class="number">1</span>);</span><br><span class="line"><span class="keyword">procedure</span> load_rom (<span class="keyword">signal</span> data_word:<span class="keyword">out</span> matrix) <span class="keyword">is</span></span><br><span class="line">    <span class="keyword">file</span> romfile:<span class="literal">text</span> <span class="keyword">open</span> read_mode <span class="keyword">is</span> <span class="string">&quot;D:\zhli\project_15\ucode.txt&quot;</span>;</span><br><span class="line">    <span class="keyword">variable</span> lbuf:<span class="literal">line</span>;</span><br><span class="line">    <span class="keyword">variable</span> i:<span class="built_in">integer</span>:=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">variable</span> fdata:<span class="built_in">std_logic_vector</span>(<span class="number">47</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> endfile(romfile) <span class="keyword">loop</span></span><br><span class="line">    readline(romfile,lbuf);</span><br><span class="line">    read(lbuf,fdata);</span><br><span class="line">    data_word(i)&lt;=fdata;</span><br><span class="line">    i:=i+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">loop</span>;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">procedure</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    load_rom(rom);</span><br><span class="line">    data&lt;=rom(conv_integer(addr));</span><br><span class="line"><span class="keyword">end</span> Behavioral;</span><br></pre></td></tr></table></figure>

<h3 id="数码管显示模块设计"><a href="#数码管显示模块设计" class="headerlink" title="数码管显示模块设计"></a>数码管显示模块设计</h3><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span> IEEE;</span><br><span class="line"><span class="keyword">use</span> IEEE.STD_LOGIC_1164.<span class="keyword">ALL</span>;</span><br><span class="line"><span class="keyword">use</span> ieee.std_logic_unsigned.<span class="keyword">all</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">entity</span> state <span class="keyword">is</span></span><br><span class="line"><span class="keyword">Port</span> (clk, rst : <span class="keyword">in</span> <span class="built_in">std_logic</span>;</span><br><span class="line">    key_in : <span class="keyword">in</span> <span class="built_in">std_logic_vector</span>(<span class="number">15</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">    seg_sel : <span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">15</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">    seg_data : <span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">    show:<span class="keyword">in</span> <span class="built_in">std_logic_vector</span>(<span class="number">63</span> <span class="keyword">downto</span> <span class="number">0</span>) );</span><br><span class="line"><span class="keyword">end</span> state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">architecture</span> Behavioral <span class="keyword">of</span> state <span class="keyword">is</span></span><br><span class="line"><span class="keyword">type</span> states <span class="keyword">is</span> (s0,s1,s2,s3,s4,s5,s6,s7,s8,s9,s10,s11,s12,s13,s14,s15);</span><br><span class="line"><span class="keyword">signal</span> state,next_state:states;</span><br><span class="line"><span class="keyword">signal</span> show1: <span class="built_in">std_logic_vector</span>(<span class="number">3</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line"><span class="keyword">signal</span> rsts,clks: <span class="built_in">std_logic</span>;</span><br><span class="line"><span class="keyword">signal</span> cc: <span class="built_in">std_logic</span>;</span><br><span class="line"><span class="keyword">signal</span> showw:<span class="built_in">std_logic_vector</span>(<span class="number">63</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">component</span> data2seg <span class="keyword">is</span></span><br><span class="line"><span class="keyword">Port</span> (data_in:<span class="keyword">in</span> <span class="built_in">std_logic_vector</span>(<span class="number">3</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">    seg_data:<span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>));</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">component</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">u: data2seg <span class="keyword">port</span> <span class="keyword">map</span>(data_in=&gt;show1, seg_data=&gt;seg_data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">process</span>(clk)</span><br><span class="line">    <span class="keyword">variable</span> count: <span class="built_in">integer</span> <span class="keyword">range</span> <span class="number">0</span> <span class="keyword">to</span> <span class="number">30000</span>;</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> clk<span class="symbol">&#x27;event</span> <span class="keyword">and</span> clk=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span></span><br><span class="line">            count:=count+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> count=<span class="number">20000</span> <span class="keyword">then</span></span><br><span class="line">            cc&lt;=<span class="keyword">not</span> cc;</span><br><span class="line">            count:=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">process</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">process</span>(cc,clk,rst)    <span class="comment">--复位和状态转移</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> rst=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> </span><br><span class="line">        state&lt;=s0;</span><br><span class="line">        showw&lt;=x<span class="string">&quot;0000000000000000&quot;</span>;</span><br><span class="line">    <span class="keyword">elsif</span> cc<span class="symbol">&#x27;event</span> <span class="keyword">and</span> cc=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span></span><br><span class="line">        showw&lt;=show;</span><br><span class="line">        state&lt;=next_state;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">if</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">process</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">process</span>(state)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> state <span class="keyword">is</span> <span class="comment">--数码管输出</span></span><br><span class="line">        <span class="keyword">when</span> s0=&gt;<span class="keyword">if</span> key_in(<span class="number">0</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;fffe&quot;</span>; show1&lt;=showw(<span class="number">3</span> <span class="keyword">downto</span> <span class="number">0</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s1;</span><br><span class="line">        <span class="keyword">when</span> s1=&gt;<span class="keyword">if</span> key_in(<span class="number">1</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;fffd&quot;</span>; show1&lt;=showw(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">4</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s2;</span><br><span class="line">        <span class="keyword">when</span> s2=&gt;<span class="keyword">if</span> key_in(<span class="number">2</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;fffb&quot;</span>; show1&lt;=showw(<span class="number">11</span> <span class="keyword">downto</span> <span class="number">8</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s3;</span><br><span class="line">        <span class="keyword">when</span> s3=&gt;<span class="keyword">if</span> key_in(<span class="number">3</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;fff7&quot;</span>; show1&lt;=showw(<span class="number">15</span> <span class="keyword">downto</span> <span class="number">12</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s4;</span><br><span class="line">        <span class="keyword">when</span> s4=&gt;<span class="keyword">if</span> key_in(<span class="number">4</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;ffef&quot;</span>; show1&lt;=showw(<span class="number">19</span> <span class="keyword">downto</span> <span class="number">16</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s5;</span><br><span class="line">        <span class="keyword">when</span> s5=&gt;<span class="keyword">if</span> key_in(<span class="number">5</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;ffdf&quot;</span>; show1&lt;=showw(<span class="number">23</span> <span class="keyword">downto</span> <span class="number">20</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s6;</span><br><span class="line">        <span class="keyword">when</span> s6=&gt;<span class="keyword">if</span> key_in(<span class="number">6</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;ffbf&quot;</span>; show1&lt;=showw(<span class="number">27</span> <span class="keyword">downto</span> <span class="number">24</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s7;</span><br><span class="line">        <span class="keyword">when</span> s7=&gt;<span class="keyword">if</span> key_in(<span class="number">7</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;ff7f&quot;</span>; show1&lt;=showw(<span class="number">31</span> <span class="keyword">downto</span> <span class="number">28</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s8;</span><br><span class="line">        <span class="keyword">when</span> s8=&gt;<span class="keyword">if</span> key_in(<span class="number">8</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;feff&quot;</span>; show1&lt;=showw(<span class="number">35</span> <span class="keyword">downto</span> <span class="number">32</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s9; </span><br><span class="line">        <span class="keyword">when</span> s9=&gt;<span class="keyword">if</span> key_in(<span class="number">9</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;fdff&quot;</span>; show1&lt;=showw(<span class="number">39</span> <span class="keyword">downto</span> <span class="number">36</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s10;</span><br><span class="line">        <span class="keyword">when</span> s10=&gt;<span class="keyword">if</span> key_in(<span class="number">10</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;fbff&quot;</span>; show1&lt;=showw(<span class="number">43</span> <span class="keyword">downto</span> <span class="number">40</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s11;</span><br><span class="line">        <span class="keyword">when</span> s11=&gt;<span class="keyword">if</span> key_in(<span class="number">11</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;f7ff&quot;</span>; show1&lt;=showw(<span class="number">47</span> <span class="keyword">downto</span> <span class="number">44</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s12;</span><br><span class="line">        <span class="keyword">when</span> s12=&gt;<span class="keyword">if</span> key_in(<span class="number">12</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;efff&quot;</span>; show1&lt;=showw(<span class="number">51</span> <span class="keyword">downto</span> <span class="number">48</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s13;</span><br><span class="line">        <span class="keyword">when</span> s13=&gt;<span class="keyword">if</span> key_in(<span class="number">13</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;dfff&quot;</span>; show1&lt;=showw(<span class="number">55</span> <span class="keyword">downto</span> <span class="number">52</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s14;</span><br><span class="line">        <span class="keyword">when</span> s14=&gt;<span class="keyword">if</span> key_in(<span class="number">14</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;bfff&quot;</span>; show1&lt;=showw(<span class="number">59</span> <span class="keyword">downto</span> <span class="number">56</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s15;</span><br><span class="line">        <span class="keyword">when</span> s15=&gt;<span class="keyword">if</span> key_in(<span class="number">15</span>)=<span class="string">&#x27;1&#x27;</span> <span class="keyword">then</span> seg_sel&lt;=x<span class="string">&quot;7fff&quot;</span>; show1&lt;=showw(<span class="number">63</span> <span class="keyword">downto</span> <span class="number">60</span>); <span class="keyword">else</span> seg_sel&lt;=x<span class="string">&quot;ffff&quot;</span>; <span class="keyword">end</span> <span class="keyword">if</span>; next_state&lt;=s0;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">case</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">process</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> Behavioral;</span><br></pre></td></tr></table></figure>

<h3 id="数码管译码模块设计"><a href="#数码管译码模块设计" class="headerlink" title="数码管译码模块设计"></a>数码管译码模块设计</h3><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">library</span> IEEE;</span><br><span class="line"><span class="keyword">use</span> IEEE.STD_LOGIC_1164.<span class="keyword">ALL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">entity</span> data2seg <span class="keyword">is</span></span><br><span class="line"><span class="keyword">Port</span> (data_in:<span class="keyword">in</span> <span class="built_in">std_logic_vector</span>(<span class="number">3</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">    seg_data:<span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>));</span><br><span class="line"><span class="keyword">end</span> data2seg;</span><br><span class="line"></span><br><span class="line"><span class="keyword">architecture</span> Behavioral <span class="keyword">of</span> data2seg <span class="keyword">is</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">process</span>(data_in)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> data_in <span class="keyword">is</span></span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;0&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;c0&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;1&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;f9&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;2&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;a4&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;3&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;b0&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;4&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;99&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;5&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;92&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;6&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;82&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;7&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;f8&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;8&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;80&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;9&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;90&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;a&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;88&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;b&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;83&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;c&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;c6&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;d&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;a1&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;e&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;86&quot;</span>;</span><br><span class="line">            <span class="keyword">when</span> x<span class="string">&quot;f&quot;</span>=&gt;seg_data&lt;=x<span class="string">&quot;8e&quot;</span>;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">case</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">process</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> Behavioral;</span><br></pre></td></tr></table></figure>

<h2 id="六、仿真配置"><a href="#六、仿真配置" class="headerlink" title="六、仿真配置"></a>六、仿真配置</h2><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span> IEEE;</span><br><span class="line"><span class="keyword">use</span> IEEE.STD_LOGIC_1164.<span class="keyword">ALL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">entity</span> micro_sim <span class="keyword">is</span></span><br><span class="line">   <span class="comment">-- Port ( clk : in STD_LOGIC);</span></span><br><span class="line"><span class="keyword">end</span> micro_sim;</span><br><span class="line"></span><br><span class="line"><span class="keyword">architecture</span> Behavioral <span class="keyword">of</span> micro_sim <span class="keyword">is</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">component</span> micro <span class="keyword">is</span></span><br><span class="line"><span class="keyword">Port</span> (clk, rst : <span class="keyword">in</span> <span class="built_in">std_logic</span>;</span><br><span class="line">    seg_sel : <span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">15</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">    seg_data : <span class="keyword">out</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>);</span><br><span class="line">    clk_mc,m_ua,cmrom_cs:<span class="keyword">in</span> <span class="built_in">std_logic</span>;</span><br><span class="line">    ir:<span class="keyword">in</span> <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">2</span>) );</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">component</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">signal</span> clk, rst,clk_mc,m_ua,cmrom_cs: <span class="built_in">std_logic</span> := <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"><span class="keyword">signal</span> seg_sel: <span class="built_in">std_logic_vector</span>(<span class="number">15</span> <span class="keyword">downto</span> <span class="number">0</span>) := (<span class="keyword">others</span>=&gt;<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">signal</span> seg_data: <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">0</span>) := (<span class="keyword">others</span>=&gt;<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">signal</span> ir: <span class="built_in">std_logic_vector</span>(<span class="number">7</span> <span class="keyword">downto</span> <span class="number">2</span>) := (<span class="keyword">others</span>=&gt;<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">constant</span> clk_period : <span class="built_in">time</span> := <span class="number">10</span> ns;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    Micro_Instance: micro</span><br><span class="line">                <span class="keyword">port</span> <span class="keyword">map</span>(</span><br><span class="line">                        clk =&gt; clk,</span><br><span class="line">                        rst =&gt; rst,</span><br><span class="line">                        seg_sel =&gt; seg_sel,</span><br><span class="line">                        seg_data =&gt; seg_data,</span><br><span class="line">                        clk_mc =&gt; clk_mc,</span><br><span class="line">                        m_ua =&gt; m_ua,</span><br><span class="line">                        cmrom_cs =&gt; cmrom_cs,</span><br><span class="line">                        ir =&gt; ir);</span><br><span class="line">    clk &lt;= <span class="keyword">not</span> clk <span class="keyword">after</span> clk_period / <span class="number">2</span>;   <span class="comment">-- clk production</span></span><br><span class="line">    clk_mc &lt;= <span class="keyword">not</span> clk_mc <span class="keyword">after</span> clk_period * <span class="number">8</span>;   <span class="comment">-- clk production</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">process</span></span><br><span class="line">     <span class="keyword">begin</span></span><br><span class="line">            cmrom_cs &lt;= <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">            <span class="comment">-- reset firstly</span></span><br><span class="line">            rst &lt;= <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">            <span class="keyword">wait</span> <span class="keyword">for</span> clk_period * <span class="number">16</span>;</span><br><span class="line">            rst &lt;= <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">          </span><br><span class="line">            <span class="comment">-- load the first instruction</span></span><br><span class="line">            m_ua &lt;= <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            <span class="keyword">wait</span> <span class="keyword">for</span> clk_period * <span class="number">16</span>;</span><br><span class="line">          </span><br><span class="line">            <span class="comment">-- load ir register</span></span><br><span class="line">            m_ua &lt;= <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">            ir &lt;= <span class="string">&quot;000001&quot;</span>;</span><br><span class="line">            <span class="keyword">wait</span> <span class="keyword">for</span> clk_period  * <span class="number">16</span>;</span><br><span class="line">          </span><br><span class="line">            <span class="comment">-- run sequencely</span></span><br><span class="line">            m_ua &lt;= <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            <span class="keyword">wait</span> <span class="keyword">for</span> clk_period  * <span class="number">48</span>;</span><br><span class="line">          </span><br><span class="line">            cmrom_cs &lt;= <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">          </span><br><span class="line">     <span class="keyword">end</span> <span class="keyword">process</span>;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">end</span> Behavioral;</span><br></pre></td></tr></table></figure>

<h2 id="七、实验结果"><a href="#七、实验结果" class="headerlink" title="七、实验结果"></a>七、实验结果</h2><h3 id="仿真结果"><a href="#仿真结果" class="headerlink" title="仿真结果"></a>仿真结果</h3><p>本次实验中，我通过使用数码管来显示微控制器的功能作用，其中各数码管的功能解释如下：</p>
<ul>
<li>0-1数码管：未使用，默认显示为00；</li>
<li>2-3数码管：显示当前微指令地址；</li>
<li>4-5数码管：显示下一天微指令地址；</li>
<li>6-15数码管：显示微指令的控制字段；</li>
</ul>
<h4 id="系统复位状态"><a href="#系统复位状态" class="headerlink" title="系统复位状态"></a>系统复位状态</h4><img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194357.png" alt="系统复位" width="80%"/>

<p>当系统复位时，即 rst &#x3D; 1，系统输出为最低为数码管显示 0 其余关闭；</p>
<h4 id="取指令公操作"><a href="#取指令公操作" class="headerlink" title="取指令公操作"></a>取指令公操作</h4><img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194411.png" alt="取指令操作" width="80%"/>

<pre><code>根据仿真结果可以看出，其16个数码管的编码值依次为 00 00 00 003119F378，微控制器默认处于取指令操作，所以该条指令下一条微指令仍然回到取指操作；
</code></pre>
<h4 id="IR实现指令跳转"><a href="#IR实现指令跳转" class="headerlink" title="IR实现指令跳转"></a>IR实现指令跳转</h4><img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194423.png" alt="指令跳转" width="80%"/>

<pre><code>根据仿真结果可以看出，其16个数码管的编码值依次为 00 01 02 8031717379，m_ua为高电平，将 IR=01H 对应地址的微指令加载到当前控制器中，所以显示正在执行当前地址为 01 的微指令，其下一条微指令的地址为 02H；
</code></pre>
<h4 id="指令顺序执行"><a href="#指令顺序执行" class="headerlink" title="指令顺序执行"></a>指令顺序执行</h4><img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194437.png" alt="指令顺序执行" width="80%"/>

<pre><code>根据仿真结果可以看出，当一个微程序执行完毕后，微控制器再次返回到取指操作对应的微指令，等待进入下一条机器指令对应的微程序入口。
</code></pre>
<h3 id="板级验证"><a href="#板级验证" class="headerlink" title="板级验证"></a>板级验证</h3><p>根据实验进一步验证，可知功能完全正确，如下图示为 IR 加载地址为 03H 的的微指令然后顺序执行一段微程序的结果。</p>
<img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194452.png" alt="当前地址为03H,下一条地址为04H" width="80%"/>
<img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194506.png" alt="当前地址为04H,下一条地址为05H" width="80%"/>
<img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194519.png" alt="当前地址为05H,下一条地址为06H" width="80%"/>
<img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194536.png" alt="当前地址为06H,下一条地址为07H" width="80%"/>
<img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194553.png" alt="当前地址为08H,下一条地址为00H" width="80%"/>
<img src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/projects/20240921194605.png" alt="当前地址为00H,下一条地址为00H" width="80%"/>
</div><div class="article-licensing box"><div class="licensing-title"><p>Micro Controller Design Based on VHDL</p><p><a href="https://lzhms.github.io/projects/MicroController/">https://lzhms.github.io/projects/MicroController/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Zhihao Li</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2024-04-28</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2024-12-09</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i> <a class="link-muted" rel="tag" href="/tags/Computer-Principle/">Computer Principle </a></div></div><div class="sharethis-inline-reaction-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=6713c7a4f9d5250012f5d817&amp;product=inline-reaction-buttons&amp;source=platform" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/essay/MyViewsOnResearch/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">我的科研理解——读《研究生的早期之路》有感</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/blog/CosineSimilarity/"><span class="level-item">Mathematic Principles about Cosine Similarity of High-dimensional Vectors</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card" id="comments"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="content twikoo" id="twikoo"></div><script src="https://cdnjs.loli.net/ajax/libs/twikoo/1.6.30/twikoo.all.min.js"></script><script>twikoo.init({
            envId: 'https://twikoo-netlify-comment.netlify.app/.netlify/functions/twikoo',
            region: "ap-guangzhou",
            lang: "en",
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-96x96 mx-auto mb-2"><img class="avatar is-rounded" src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/profile/avatar.png" alt="Zhihao Li"></figure><p class="title is-size-4 is-block" style="line-height: 'inherit';">Zhihao Li</p><p style="white-space: pre-line; font-style: italic; margin-bottom: 0.50rem; font-size: 1.0em">Computer Science
Machine Learning
</p><p class="is-size-5 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Xidian University, Xi&#039;an, China</span></p></div></div></nav><nav class="level menu-list is-mobile" style="margin-bottom:1rem"><a class="level-item has-text-centered is-marginless" href="/archives/"><div><p class="heading">Posts</p><div><p class="title">60</p></div></div></a><a class="level-item has-text-centered is-marginless" href="/categories/"><div><p class="heading">Categories</p><div><p class="title">6</p></div></div></a><a class="level-item has-text-centered is-marginless" href="/tags/"><div><p class="heading">Tags</p><div><p class="title">43</p></div></div></a></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/LZHMS" target="_blank" rel="noopener"><i class="fab fa-github"></i>  Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="QQ" href="https://jsd.cdn.zzko.cn/gh/LZHMS/picx-images-hosting@master/Profile/1730463517285_temp_qrcode_share_9993.64dv175zqu.webp"><i class="iconfont icon-QQ1"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="WeChat" href="https://jsd.cdn.zzko.cn/gh/LZHMS/picx-images-hosting@master/Profile/0add852711e38990022788ba88dd062.3nrmm9y3ql.webp"><i class="iconfont icon-wechat-"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:zhihaoli@stu.xidian.edu.cn"><i class="iconfont icon-email2"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Transcript_EN" href="/./pdf/profile/transcript_en.pdf"><i class="iconfont icon-chengjidan1"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Transcript_ZH" href="/./pdf/profile/transcript_zh.pdf"><i class="iconfont icon-chengjidan"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#一、实验目的"><span class="level-left"><span class="level-item">1</span><span class="level-item">一、实验目的</span></span></a></li><li><a class="level is-mobile" href="#二、实验要求"><span class="level-left"><span class="level-item">2</span><span class="level-item">二、实验要求</span></span></a></li><li><a class="level is-mobile" href="#三、实验方案及工作原理"><span class="level-left"><span class="level-item">3</span><span class="level-item">三、实验方案及工作原理</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#微程序控制器基本结构"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">微程序控制器基本结构</span></span></a></li><li><a class="level is-mobile" href="#控制信号汇总"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">控制信号汇总</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#PC-模块（4条）"><span class="level-left"><span class="level-item">3.2.1</span><span class="level-item">PC 模块（4条）</span></span></a></li><li><a class="level is-mobile" href="#ROM-模块（2条）"><span class="level-left"><span class="level-item">3.2.2</span><span class="level-item">ROM 模块（2条）</span></span></a></li><li><a class="level is-mobile" href="#IR-模块（4-条）"><span class="level-left"><span class="level-item">3.2.3</span><span class="level-item">IR 模块（4 条）</span></span></a></li><li><a class="level is-mobile" href="#RN-模块（4-条）"><span class="level-left"><span class="level-item">3.2.4</span><span class="level-item">RN 模块（4 条）</span></span></a></li><li><a class="level is-mobile" href="#ALU-模块（13-条）"><span class="level-left"><span class="level-item">3.2.5</span><span class="level-item">ALU 模块（13 条）</span></span></a></li><li><a class="level is-mobile" href="#RAM-模块（3-条）"><span class="level-left"><span class="level-item">3.2.6</span><span class="level-item">RAM 模块（3 条）</span></span></a></li></ul></li><li><a class="level is-mobile" href="#控制信号设计"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">控制信号设计</span></span></a></li><li><a class="level is-mobile" href="#微指令编码设计"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">微指令编码设计</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#取指公操作：微程序入口地址-00H"><span class="level-left"><span class="level-item">3.4.1</span><span class="level-item">取指公操作：微程序入口地址 00H</span></span></a></li></ul></li><li><a class="level is-mobile" href="#微程序设计"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">微程序设计</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#MOV-Ri-data：微程序入口地址-24H"><span class="level-left"><span class="level-item">3.5.1</span><span class="level-item">MOV Ri, #data：微程序入口地址 24H</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#四、实验配置"><span class="level-left"><span class="level-item">4</span><span class="level-item">四、实验配置</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#微程序设计-1"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">微程序设计</span></span></a></li><li><a class="level is-mobile" href="#微控制器功能设计"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">微控制器功能设计</span></span></a></li></ul></li><li><a class="level is-mobile" href="#五、实验源码"><span class="level-left"><span class="level-item">5</span><span class="level-item">五、实验源码</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#顶层模块设计"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">顶层模块设计</span></span></a></li><li><a class="level is-mobile" href="#微控制器模块设计"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">微控制器模块设计</span></span></a></li><li><a class="level is-mobile" href="#控制存储器模块设计"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">控制存储器模块设计</span></span></a></li><li><a class="level is-mobile" href="#数码管显示模块设计"><span class="level-left"><span class="level-item">5.4</span><span class="level-item">数码管显示模块设计</span></span></a></li><li><a class="level is-mobile" href="#数码管译码模块设计"><span class="level-left"><span class="level-item">5.5</span><span class="level-item">数码管译码模块设计</span></span></a></li></ul></li><li><a class="level is-mobile" href="#六、仿真配置"><span class="level-left"><span class="level-item">6</span><span class="level-item">六、仿真配置</span></span></a></li><li><a class="level is-mobile" href="#七、实验结果"><span class="level-left"><span class="level-item">7</span><span class="level-item">七、实验结果</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#仿真结果"><span class="level-left"><span class="level-item">7.1</span><span class="level-item">仿真结果</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#系统复位状态"><span class="level-left"><span class="level-item">7.1.1</span><span class="level-item">系统复位状态</span></span></a></li><li><a class="level is-mobile" href="#取指令公操作"><span class="level-left"><span class="level-item">7.1.2</span><span class="level-item">取指令公操作</span></span></a></li><li><a class="level is-mobile" href="#IR实现指令跳转"><span class="level-left"><span class="level-item">7.1.3</span><span class="level-item">IR实现指令跳转</span></span></a></li><li><a class="level is-mobile" href="#指令顺序执行"><span class="level-left"><span class="level-item">7.1.4</span><span class="level-item">指令顺序执行</span></span></a></li></ul></li><li><a class="level is-mobile" href="#板级验证"><span class="level-left"><span class="level-item">7.2</span><span class="level-item">板级验证</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/blog/"><span class="level-start"><span class="level-item">blog</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/collaboration/"><span class="level-start"><span class="level-item">collaboration</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/essay/"><span class="level-start"><span class="level-item">essay</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/movies/"><span class="level-start"><span class="level-item">movies</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/projects/"><span class="level-start"><span class="level-item">projects</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/readings/"><span class="level-start"><span class="level-item">readings</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Embedded-System/"><span class="tag">Embedded System</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Project-Tools/"><span class="tag">Project Tools</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Computer-Graphics/"><span class="tag">Computer Graphics</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Professional-Knowledge/"><span class="tag">Professional Knowledge</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Diffusion-Model/"><span class="tag">Diffusion Model</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AIGC/"><span class="tag">AIGC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Project-Habits/"><span class="tag">Project Habits</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GAN/"><span class="tag">GAN</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Mathematical-Modeling/"><span class="tag">Mathematical Modeling</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Data-Visualization/"><span class="tag">Data Visualization</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OpenSSL/"><span class="tag">OpenSSL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Volume-Rendering/"><span class="tag">Volume Rendering</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows/"><span class="tag">Windows</span><span class="tag">1</span></a></div></div><div class="more-link"><a href="/tags/">View All Tags &gt;&gt;</a></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img class="logo-img" src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/profile/logo_light.png" alt="Zhihao Li - Zhihao Li&#039;s Blog" height="28"><img class="logo-img-dark" src="https://lzhms.oss-cn-hangzhou.aliyuncs.com/images/blog/profile/logo_dark.png" alt="Zhihao Li - Zhihao Li&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023-2024 Zhihao Li</span><br><span id="busuanzi_container_site_uv"><span id="busuanzi_container_site_uv">Site UV: <span id="busuanzi_value_site_uv"></span></span>   <span id="busuanzi_container_site_pv">Site PV: <span id="busuanzi_value_site_pv"></span></span></span></p><p class="is-size-7"> </p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="HuggingFace" href="https://huggingface.co/LZHMS"><i class="iconfont icon-huggingface"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Bilibili" href="https://space.bilibili.com/2079836440"><i class="iconfont icon-bilibili"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="ZhiHu" href="https://www.zhihu.com/people/zhao.li"><i class="iconfont icon-zhihu"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="CSDN" href="https://blog.csdn.net/weixin_63554791"><i class="iconfont icon-csdn"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdnjs.loli.net/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script><!--!--><script data-pjax src="/js/main.js" defer></script><script data-pjax src="/js/night.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><div id="dark" onclick="switchDarkMode()"></div><script type="text/javascript" src="/js/universe.js"></script></body></html>